{% extends 'layout.html' %}
{% block title %}
  Scan QR Code
{% endblock %}
{% block content %}
<main class="flex-1 p-6">
  <div class="p-6">
    <!-- Page Title -->
    <h1 class="text-3xl font-bold text-gray-800 mb-6">Scan QR Code</h1>

    <!-- QR Scanner -->
    <div class="bg-white p-6 rounded-lg shadow-lg flex flex-col items-center space-y-6">
      <!-- Camera Scanner -->
      <div>
        <h2 class="text-lg font-semibold text-gray-700 mb-2 text-center">Scan with Camera</h2>
        <div id="reader" class="w-60 h-60 border-2 border-dashed border-gray-400 rounded-lg"></div>
      </div>

      <!-- OR Divider -->
      <div class="flex items-center w-full">
        <div class="flex-grow border-t border-gray-300"></div>
        <span class="mx-2 text-gray-500">OR</span>
        <div class="flex-grow border-t border-gray-300"></div>
      </div>

      <!-- Upload QR Image -->
      <div>
        <h2 class="text-lg font-semibold text-gray-700 mb-2 text-center">Upload QR Image</h2>
        <form method="post" enctype="multipart/form-data" class="flex flex-col items-center gap-3">
          {% csrf_token %}
          <input type="file" name="qr_image" accept="image/*" class="border border-gray-300 rounded px-3 py-2 w-64" />
          <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-500">Upload & Verify</button>
        </form>
      </div>

      <!-- Result Box -->
      {% if message %}
        <div class="mt-4 px-4 py-2 rounded-lg 
                  {% if success %}
             bg-green-100 text-green-700
          {% else %}
             bg-red-100 text-red-700
          {% endif %}">{{ message }}</div>
      {% endif %}
    </div>
  </div>
</main>
  <!-- QR Scanner Script -->
  <script src="https://unpkg.com/html5-qrcode/minified/html5-qrcode.min.js"></script>
  <script>
    function onScanSuccess(decodedText) {
      // Redirect to attendance marking URL with scanned data
      window.location.href = "{% url 'mark_attendance' %}?qr=" + encodeURIComponent(decodedText)
    }
    
    function onScanError(errorMessage) {
      // Just log errors (optional)
      console.log(errorMessage)
    }
    
    let html5QrcodeScanner = new Html5QrcodeScanner('reader', { fps: 10, qrbox: 250 })
    html5QrcodeScanner.render(onScanSuccess, onScanError)
  </script>
{% endblock %}
